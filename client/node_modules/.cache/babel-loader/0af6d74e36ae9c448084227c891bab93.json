{"ast":null,"code":"'use strict'; // tar -c\n\nvar hlo = require('./high-level-opt.js');\n\nvar Pack = require('./pack.js');\n\nvar fs = require('fs');\n\nvar fsm = require('fs-minipass');\n\nvar t = require('./list.js');\n\nvar path = require('path');\n\nvar c = module.exports = function (opt_, files, cb) {\n  if (typeof files === 'function') cb = files;\n  if (Array.isArray(opt_)) files = opt_, opt_ = {};\n  if (!files || !Array.isArray(files) || !files.length) throw new TypeError('no files or directories specified');\n  files = Array.from(files);\n  var opt = hlo(opt_);\n  if (opt.sync && typeof cb === 'function') throw new TypeError('callback not supported for sync tar functions');\n  if (!opt.file && typeof cb === 'function') throw new TypeError('callback only supported with file option');\n  return opt.file && opt.sync ? createFileSync(opt, files) : opt.file ? createFile(opt, files, cb) : opt.sync ? createSync(opt, files) : create(opt, files);\n};\n\nvar createFileSync = function createFileSync(opt, files) {\n  var p = new Pack.Sync(opt);\n  var stream = new fsm.WriteStreamSync(opt.file, {\n    mode: opt.mode || 438\n  });\n  p.pipe(stream);\n  addFilesSync(p, files);\n};\n\nvar createFile = function createFile(opt, files, cb) {\n  var p = new Pack(opt);\n  var stream = new fsm.WriteStream(opt.file, {\n    mode: opt.mode || 438\n  });\n  p.pipe(stream);\n  var promise = new Promise(function (res, rej) {\n    stream.on('error', rej);\n    stream.on('close', res);\n    p.on('error', rej);\n  });\n  addFilesAsync(p, files);\n  return cb ? promise.then(cb, cb) : promise;\n};\n\nvar addFilesSync = function addFilesSync(p, files) {\n  files.forEach(function (file) {\n    if (file.charAt(0) === '@') t({\n      file: path.resolve(p.cwd, file.substr(1)),\n      sync: true,\n      noResume: true,\n      onentry: function onentry(entry) {\n        return p.add(entry);\n      }\n    });else p.add(file);\n  });\n  p.end();\n};\n\nvar addFilesAsync = function addFilesAsync(p, files) {\n  while (files.length) {\n    var file = files.shift();\n    if (file.charAt(0) === '@') return t({\n      file: path.resolve(p.cwd, file.substr(1)),\n      noResume: true,\n      onentry: function onentry(entry) {\n        return p.add(entry);\n      }\n    }).then(function (_) {\n      return addFilesAsync(p, files);\n    });else p.add(file);\n  }\n\n  p.end();\n};\n\nvar createSync = function createSync(opt, files) {\n  var p = new Pack.Sync(opt);\n  addFilesSync(p, files);\n  return p;\n};\n\nvar create = function create(opt, files) {\n  var p = new Pack(opt);\n  addFilesAsync(p, files);\n  return p;\n};","map":null,"metadata":{},"sourceType":"script"}