{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { extendWithAge } from '../factories/WithAge';\nimport { extendWithGender } from '../factories/WithGender';\nimport { ComposableTask } from './ComposableTask';\nimport { ComputeAllFaceDescriptorsTask, ComputeSingleFaceDescriptorTask } from './ComputeFaceDescriptorsTasks';\nimport { extractAllFacesAndComputeResults, extractSingleFaceAndComputeResult } from './extractFacesAndComputeResults';\nimport { nets } from './nets';\nimport { PredictAllFaceExpressionsTask, PredictAllFaceExpressionsWithFaceAlignmentTask, PredictSingleFaceExpressionsTask, PredictSingleFaceExpressionsWithFaceAlignmentTask } from './PredictFaceExpressionsTask';\n\nvar PredictAgeAndGenderTaskBase =\n/** @class */\nfunction (_super) {\n  __extends(PredictAgeAndGenderTaskBase, _super);\n\n  function PredictAgeAndGenderTaskBase(parentTask, input, extractedFaces) {\n    var _this = _super.call(this) || this;\n\n    _this.parentTask = parentTask;\n    _this.input = input;\n    _this.extractedFaces = extractedFaces;\n    return _this;\n  }\n\n  return PredictAgeAndGenderTaskBase;\n}(ComposableTask);\n\nexport { PredictAgeAndGenderTaskBase };\n\nvar PredictAllAgeAndGenderTask =\n/** @class */\nfunction (_super) {\n  __extends(PredictAllAgeAndGenderTask, _super);\n\n  function PredictAllAgeAndGenderTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  PredictAllAgeAndGenderTask.prototype.run = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var parentResults, ageAndGenderByFace;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.parentTask];\n\n          case 1:\n            parentResults = _a.sent();\n            return [4\n            /*yield*/\n            , extractAllFacesAndComputeResults(parentResults, this.input, function (faces) {\n              return __awaiter(_this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4\n                      /*yield*/\n                      , Promise.all(faces.map(function (face) {\n                        return nets.ageGenderNet.predictAgeAndGender(face);\n                      }))];\n\n                    case 1:\n                      return [2\n                      /*return*/\n                      , _a.sent()];\n                  }\n                });\n              });\n            }, this.extractedFaces)];\n\n          case 2:\n            ageAndGenderByFace = _a.sent();\n            return [2\n            /*return*/\n            , parentResults.map(function (parentResult, i) {\n              var _a = ageAndGenderByFace[i],\n                  age = _a.age,\n                  gender = _a.gender,\n                  genderProbability = _a.genderProbability;\n              return extendWithAge(extendWithGender(parentResult, gender, genderProbability), age);\n            })];\n        }\n      });\n    });\n  };\n\n  PredictAllAgeAndGenderTask.prototype.withFaceExpressions = function () {\n    return new PredictAllFaceExpressionsTask(this, this.input);\n  };\n\n  return PredictAllAgeAndGenderTask;\n}(PredictAgeAndGenderTaskBase);\n\nexport { PredictAllAgeAndGenderTask };\n\nvar PredictSingleAgeAndGenderTask =\n/** @class */\nfunction (_super) {\n  __extends(PredictSingleAgeAndGenderTask, _super);\n\n  function PredictSingleAgeAndGenderTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  PredictSingleAgeAndGenderTask.prototype.run = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var parentResult, _a, age, gender, genderProbability;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.parentTask];\n\n          case 1:\n            parentResult = _b.sent();\n\n            if (!parentResult) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , extractSingleFaceAndComputeResult(parentResult, this.input, function (face) {\n              return nets.ageGenderNet.predictAgeAndGender(face);\n            }, this.extractedFaces)];\n\n          case 2:\n            _a = _b.sent(), age = _a.age, gender = _a.gender, genderProbability = _a.genderProbability;\n            return [2\n            /*return*/\n            , extendWithAge(extendWithGender(parentResult, gender, genderProbability), age)];\n        }\n      });\n    });\n  };\n\n  PredictSingleAgeAndGenderTask.prototype.withFaceExpressions = function () {\n    return new PredictSingleFaceExpressionsTask(this, this.input);\n  };\n\n  return PredictSingleAgeAndGenderTask;\n}(PredictAgeAndGenderTaskBase);\n\nexport { PredictSingleAgeAndGenderTask };\n\nvar PredictAllAgeAndGenderWithFaceAlignmentTask =\n/** @class */\nfunction (_super) {\n  __extends(PredictAllAgeAndGenderWithFaceAlignmentTask, _super);\n\n  function PredictAllAgeAndGenderWithFaceAlignmentTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  PredictAllAgeAndGenderWithFaceAlignmentTask.prototype.withFaceExpressions = function () {\n    return new PredictAllFaceExpressionsWithFaceAlignmentTask(this, this.input);\n  };\n\n  PredictAllAgeAndGenderWithFaceAlignmentTask.prototype.withFaceDescriptors = function () {\n    return new ComputeAllFaceDescriptorsTask(this, this.input);\n  };\n\n  return PredictAllAgeAndGenderWithFaceAlignmentTask;\n}(PredictAllAgeAndGenderTask);\n\nexport { PredictAllAgeAndGenderWithFaceAlignmentTask };\n\nvar PredictSingleAgeAndGenderWithFaceAlignmentTask =\n/** @class */\nfunction (_super) {\n  __extends(PredictSingleAgeAndGenderWithFaceAlignmentTask, _super);\n\n  function PredictSingleAgeAndGenderWithFaceAlignmentTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  PredictSingleAgeAndGenderWithFaceAlignmentTask.prototype.withFaceExpressions = function () {\n    return new PredictSingleFaceExpressionsWithFaceAlignmentTask(this, this.input);\n  };\n\n  PredictSingleAgeAndGenderWithFaceAlignmentTask.prototype.withFaceDescriptor = function () {\n    return new ComputeSingleFaceDescriptorTask(this, this.input);\n  };\n\n  return PredictSingleAgeAndGenderWithFaceAlignmentTask;\n}(PredictSingleAgeAndGenderTask);\n\nexport { PredictSingleAgeAndGenderWithFaceAlignmentTask };","map":{"version":3,"sources":["../../../src/globalApi/PredictAgeAndGenderTask.ts"],"names":[],"mappings":";AAIA,SAAS,aAAT,QAAuC,sBAAvC;AAGA,SAAS,gBAAT,QAA6C,yBAA7C;AACA,SAAS,cAAT,QAA+B,kBAA/B;AACA,SAAS,6BAAT,EAAwC,+BAAxC,QAA+E,+BAA/E;AACA,SAAS,gCAAT,EAA2C,iCAA3C,QAAoF,iCAApF;AACA,SAAS,IAAT,QAAqB,QAArB;AACA,SACE,6BADF,EAEE,8CAFF,EAGE,gCAHF,EAIE,iDAJF,QAKO,8BALP;;AAOA,IAAA,2BAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAAyE,EAAA,SAAA,CAAA,2BAAA,EAAA,MAAA,CAAA;;AACvE,WAAA,2BAAA,CACY,UADZ,EAEY,KAFZ,EAGY,cAHZ,EAGmE;AAHnE,QAAA,KAAA,GAKE,MAAA,CAAA,IAAA,CAAA,IAAA,KAAO,IALT;;AACY,IAAA,KAAA,CAAA,UAAA,GAAA,UAAA;AACA,IAAA,KAAA,CAAA,KAAA,GAAA,KAAA;AACA,IAAA,KAAA,CAAA,cAAA,GAAA,cAAA;;AAGX;;AACH,SAAA,2BAAA;AAAC,CARD,CAAyE,cAAzE,CAAA;;;;AAUA,IAAA,0BAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAEU,EAAA,SAAA,CAAA,0BAAA,EAAA,MAAA,CAAA;;AAFV,WAAA,0BAAA,GAAA;;AA0BC;;AAtBc,EAAA,0BAAA,CAAA,SAAA,CAAA,GAAA,GAAb,YAAA;;;;;;;;;AAEwB,mBAAA,CAAA;AAAA;AAAA,cAAM,KAAK,UAAX,CAAA;;;AAAhB,YAAA,aAAa,GAAG,EAAA,CAAA,IAAA,EAAhB;AAEqB,mBAAA,CAAA;AAAA;AAAA,cAAM,gCAAgC,CAC/D,aAD+D,EAE/D,KAAK,KAF0D,EAG/D,UAAM,KAAN,EAAW;AAAA,qBAAA,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;AAAI,6BAAA,CAAA;AAAA;AAAA,wBAAM,OAAO,CAAC,GAAR,CAAY,KAAK,CAAC,GAAN,CAC/B,UAAA,IAAA,EAAI;AAAI,+BAAA,IAAI,CAAC,YAAL,CAAkB,mBAAlB,CAAA,IAAA,CAAA;AAA8E,uBADvD,CAAZ,CAAN,CAAA;;;AAAA,6BAAA,CAAA;AAAA;AAAA,wBAAA,EAAA,CAAA,IAAA,EAAA,CAAA;;;eAAJ,CAAA;AAET,aAL6D,EAM/D,KAAK,cAN0D,CAAtC,CAAA;;;AAArB,YAAA,kBAAkB,GAAG,EAAA,CAAA,IAAA,EAArB;AASN,mBAAA,CAAA;AAAA;AAAA,cAAO,aAAa,CAAC,GAAd,CAAkB,UAAC,YAAD,EAAe,CAAf,EAAgB;AACjC,kBAAA,EAAA,GAAA,kBAAA,CAAA,CAAA,CAAA;AAAA,kBAAE,GAAA,GAAA,EAAA,CAAA,GAAF;AAAA,kBAAO,MAAA,GAAA,EAAA,CAAA,MAAP;AAAA,kBAAe,iBAAA,GAAA,EAAA,CAAA,iBAAf;AACN,qBAAO,aAAa,CAAC,gBAAgB,CAAC,YAAD,EAAe,MAAf,EAAuB,iBAAvB,CAAjB,EAA4D,GAA5D,CAApB;AACD,aAHM,CAAP,CAAA;;;;AAID,GAjBY;;AAmBb,EAAA,0BAAA,CAAA,SAAA,CAAA,mBAAA,GAAA,YAAA;AACE,WAAO,IAAI,6BAAJ,CAAkC,IAAlC,EAAwC,KAAK,KAA7C,CAAP;AACD,GAFD;;AAGF,SAAA,0BAAA;AAAC,CA1BD,CAEU,2BAFV,CAAA;;;;AA4BA,IAAA,6BAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAEW,EAAA,SAAA,CAAA,6BAAA,EAAA,MAAA,CAAA;;AAFX,WAAA,6BAAA,GAAA;;AAwBC;;AApBc,EAAA,6BAAA,CAAA,SAAA,CAAA,GAAA,GAAb,YAAA;;;;;;;AAEuB,mBAAA,CAAA;AAAA;AAAA,cAAM,KAAK,UAAX,CAAA;;;AAAf,YAAA,YAAY,GAAG,EAAA,CAAA,IAAA,EAAf;;AACN,gBAAI,CAAC,YAAL,EAAmB;AACjB,qBAAA,CAAA;AAAA;AAAA,eAAA;AACD;;AAE0C,mBAAA,CAAA;AAAA;AAAA,cAAM,iCAAiC,CAChF,YADgF,EAEhF,KAAK,KAF2E,EAGhF,UAAA,IAAA,EAAI;AAAI,qBAAA,IAAI,CAAC,YAAL,CAAkB,mBAAlB,CAAA,IAAA,CAAA;AAA8E,aAHN,EAIhF,KAAK,cAJ2E,CAAvC,CAAA;;;AAArC,YAAA,EAAA,GAAqC,EAAA,CAAA,IAAA,EAArC,EAAE,GAAG,GAAA,EAAA,CAAA,GAAL,EAAO,MAAM,GAAA,EAAA,CAAA,MAAb,EAAe,iBAAiB,GAAA,EAAA,CAAA,iBAAhC;AAON,mBAAA,CAAA;AAAA;AAAA,cAAO,aAAa,CAAC,gBAAgB,CAAC,YAAD,EAAe,MAAf,EAAuB,iBAAvB,CAAjB,EAA4D,GAA5D,CAApB,CAAA;;;;AACD,GAfY;;AAiBb,EAAA,6BAAA,CAAA,SAAA,CAAA,mBAAA,GAAA,YAAA;AACE,WAAO,IAAI,gCAAJ,CAAqC,IAArC,EAA2C,KAAK,KAAhD,CAAP;AACD,GAFD;;AAGF,SAAA,6BAAA;AAAC,CAxBD,CAEW,2BAFX,CAAA;;;;AA0BA,IAAA,2CAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAEU,EAAA,SAAA,CAAA,2CAAA,EAAA,MAAA,CAAA;;AAFV,WAAA,2CAAA,GAAA;;AAWC;;AAPC,EAAA,2CAAA,CAAA,SAAA,CAAA,mBAAA,GAAA,YAAA;AACE,WAAO,IAAI,8CAAJ,CAAmD,IAAnD,EAAyD,KAAK,KAA9D,CAAP;AACD,GAFD;;AAIA,EAAA,2CAAA,CAAA,SAAA,CAAA,mBAAA,GAAA,YAAA;AACE,WAAO,IAAI,6BAAJ,CAAkC,IAAlC,EAAwC,KAAK,KAA7C,CAAP;AACD,GAFD;;AAGF,SAAA,2CAAA;AAAC,CAXD,CAEU,0BAFV,CAAA;;;;AAaA,IAAA,8CAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAEU,EAAA,SAAA,CAAA,8CAAA,EAAA,MAAA,CAAA;;AAFV,WAAA,8CAAA,GAAA;;AAWC;;AAPC,EAAA,8CAAA,CAAA,SAAA,CAAA,mBAAA,GAAA,YAAA;AACE,WAAO,IAAI,iDAAJ,CAAsD,IAAtD,EAA4D,KAAK,KAAjE,CAAP;AACD,GAFD;;AAIA,EAAA,8CAAA,CAAA,SAAA,CAAA,kBAAA,GAAA,YAAA;AACE,WAAO,IAAI,+BAAJ,CAAoC,IAApC,EAA0C,KAAK,KAA/C,CAAP;AACD,GAFD;;AAGF,SAAA,8CAAA;AAAC,CAXD,CAEU,6BAFV,CAAA","sourceRoot":"","sourcesContent":["import { __awaiter, __extends, __generator } from \"tslib\";\r\nimport { extendWithAge } from '../factories/WithAge';\r\nimport { extendWithGender } from '../factories/WithGender';\r\nimport { ComposableTask } from './ComposableTask';\r\nimport { ComputeAllFaceDescriptorsTask, ComputeSingleFaceDescriptorTask } from './ComputeFaceDescriptorsTasks';\r\nimport { extractAllFacesAndComputeResults, extractSingleFaceAndComputeResult } from './extractFacesAndComputeResults';\r\nimport { nets } from './nets';\r\nimport { PredictAllFaceExpressionsTask, PredictAllFaceExpressionsWithFaceAlignmentTask, PredictSingleFaceExpressionsTask, PredictSingleFaceExpressionsWithFaceAlignmentTask, } from './PredictFaceExpressionsTask';\r\nvar PredictAgeAndGenderTaskBase = /** @class */ (function (_super) {\r\n    __extends(PredictAgeAndGenderTaskBase, _super);\r\n    function PredictAgeAndGenderTaskBase(parentTask, input, extractedFaces) {\r\n        var _this = _super.call(this) || this;\r\n        _this.parentTask = parentTask;\r\n        _this.input = input;\r\n        _this.extractedFaces = extractedFaces;\r\n        return _this;\r\n    }\r\n    return PredictAgeAndGenderTaskBase;\r\n}(ComposableTask));\r\nexport { PredictAgeAndGenderTaskBase };\r\nvar PredictAllAgeAndGenderTask = /** @class */ (function (_super) {\r\n    __extends(PredictAllAgeAndGenderTask, _super);\r\n    function PredictAllAgeAndGenderTask() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    PredictAllAgeAndGenderTask.prototype.run = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var parentResults, ageAndGenderByFace;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.parentTask];\r\n                    case 1:\r\n                        parentResults = _a.sent();\r\n                        return [4 /*yield*/, extractAllFacesAndComputeResults(parentResults, this.input, function (faces) { return __awaiter(_this, void 0, void 0, function () {\r\n                                return __generator(this, function (_a) {\r\n                                    switch (_a.label) {\r\n                                        case 0: return [4 /*yield*/, Promise.all(faces.map(function (face) { return nets.ageGenderNet.predictAgeAndGender(face); }))];\r\n                                        case 1: return [2 /*return*/, _a.sent()];\r\n                                    }\r\n                                });\r\n                            }); }, this.extractedFaces)];\r\n                    case 2:\r\n                        ageAndGenderByFace = _a.sent();\r\n                        return [2 /*return*/, parentResults.map(function (parentResult, i) {\r\n                                var _a = ageAndGenderByFace[i], age = _a.age, gender = _a.gender, genderProbability = _a.genderProbability;\r\n                                return extendWithAge(extendWithGender(parentResult, gender, genderProbability), age);\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    PredictAllAgeAndGenderTask.prototype.withFaceExpressions = function () {\r\n        return new PredictAllFaceExpressionsTask(this, this.input);\r\n    };\r\n    return PredictAllAgeAndGenderTask;\r\n}(PredictAgeAndGenderTaskBase));\r\nexport { PredictAllAgeAndGenderTask };\r\nvar PredictSingleAgeAndGenderTask = /** @class */ (function (_super) {\r\n    __extends(PredictSingleAgeAndGenderTask, _super);\r\n    function PredictSingleAgeAndGenderTask() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    PredictSingleAgeAndGenderTask.prototype.run = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var parentResult, _a, age, gender, genderProbability;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4 /*yield*/, this.parentTask];\r\n                    case 1:\r\n                        parentResult = _b.sent();\r\n                        if (!parentResult) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, extractSingleFaceAndComputeResult(parentResult, this.input, function (face) { return nets.ageGenderNet.predictAgeAndGender(face); }, this.extractedFaces)];\r\n                    case 2:\r\n                        _a = _b.sent(), age = _a.age, gender = _a.gender, genderProbability = _a.genderProbability;\r\n                        return [2 /*return*/, extendWithAge(extendWithGender(parentResult, gender, genderProbability), age)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    PredictSingleAgeAndGenderTask.prototype.withFaceExpressions = function () {\r\n        return new PredictSingleFaceExpressionsTask(this, this.input);\r\n    };\r\n    return PredictSingleAgeAndGenderTask;\r\n}(PredictAgeAndGenderTaskBase));\r\nexport { PredictSingleAgeAndGenderTask };\r\nvar PredictAllAgeAndGenderWithFaceAlignmentTask = /** @class */ (function (_super) {\r\n    __extends(PredictAllAgeAndGenderWithFaceAlignmentTask, _super);\r\n    function PredictAllAgeAndGenderWithFaceAlignmentTask() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    PredictAllAgeAndGenderWithFaceAlignmentTask.prototype.withFaceExpressions = function () {\r\n        return new PredictAllFaceExpressionsWithFaceAlignmentTask(this, this.input);\r\n    };\r\n    PredictAllAgeAndGenderWithFaceAlignmentTask.prototype.withFaceDescriptors = function () {\r\n        return new ComputeAllFaceDescriptorsTask(this, this.input);\r\n    };\r\n    return PredictAllAgeAndGenderWithFaceAlignmentTask;\r\n}(PredictAllAgeAndGenderTask));\r\nexport { PredictAllAgeAndGenderWithFaceAlignmentTask };\r\nvar PredictSingleAgeAndGenderWithFaceAlignmentTask = /** @class */ (function (_super) {\r\n    __extends(PredictSingleAgeAndGenderWithFaceAlignmentTask, _super);\r\n    function PredictSingleAgeAndGenderWithFaceAlignmentTask() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    PredictSingleAgeAndGenderWithFaceAlignmentTask.prototype.withFaceExpressions = function () {\r\n        return new PredictSingleFaceExpressionsWithFaceAlignmentTask(this, this.input);\r\n    };\r\n    PredictSingleAgeAndGenderWithFaceAlignmentTask.prototype.withFaceDescriptor = function () {\r\n        return new ComputeSingleFaceDescriptorTask(this, this.input);\r\n    };\r\n    return PredictSingleAgeAndGenderWithFaceAlignmentTask;\r\n}(PredictSingleAgeAndGenderTask));\r\nexport { PredictSingleAgeAndGenderWithFaceAlignmentTask };\r\n//# sourceMappingURL=PredictAgeAndGenderTask.js.map"]},"metadata":{},"sourceType":"module"}